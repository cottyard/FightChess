{
  "version": 3,
  "file": "peer.js",
  "sourceRoot": "..\\..",
  "sources": [
    "src\\network\\peer.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "data = {\r\n  'status': ['host', 'begin']\r\n  'connection',\r\n  'channel'\r\n}\r\n\r\ninputs = {\r\n  'role_btn',\r\n  'local_offer_btn',\r\n  'local_answer_btn',\r\n  'status',\r\n  'send_txt',\r\n  'chat'\r\n}\r\n\r\nchange_status = (status) ->\r\n  data.status = status\r\n  [type, phase] = status\r\n  status_binds[type][phase]()\r\n\r\nstatus_binds =\r\n  'host':\r\n    'begin': ->\r\n      enable inputs.local_offer_btn\r\n      hide inputs.local_answer_btn\r\n      inputs.status.value = 'Please send your offer to your peer.'\r\n    'pending': ->\r\n      enable inputs.local_offer_btn\r\n      hide inputs.local_answer_btn\r\n      inputs.status.value = 'Please paste the answer you received from your peer.'\r\n    'connected': ->\r\n      hide inputs.local_offer_btn\r\n      hide inputs.local_answer_btn\r\n      inputs.status.value = 'You are connected to your peer.'\r\n  'guest':\r\n    'begin': ->\r\n      hide inputs.local_offer_btn\r\n      disable inputs.local_answer_btn\r\n      inputs.status.value = 'Please paste the offer you received from your peer.'\r\n    'pending': ->\r\n      hide inputs.local_offer_btn\r\n      enable inputs.local_answer_btn\r\n      inputs.status.value = 'Please send the answer to your peer.'\r\n    'connected': ->\r\n      hide inputs.local_offer_btn\r\n      hide inputs.local_answer_btn\r\n      inputs.status.value = 'You are connected to your peer.'\r\n\r\ninit = ->\r\n  for i of inputs\r\n    inputs[i] = document.getElementById i\r\n  change_status data.status\r\n  data.connection = new RTCPeerConnection({iceServers: [{urls: []}]});\r\n  init_data_channel data.connection\r\n  data.connection.ondatachannel = receive_data_channel\r\n  document.addEventListener 'paste', remote_onpaste\r\n\r\nenable = (btn) ->\r\n  btn.style.display = ''\r\n  btn.disabled = false\r\n\r\ndisable = (btn) ->\r\n  btn.style.display = ''\r\n  btn.disabled = true\r\n\r\nhide = (btn) ->\r\n  btn.style.display = 'none'\r\n\r\nset_clipboard = (message) ->\r\n  dummy = document.createElement \"input\"\r\n  document.body.appendChild dummy\r\n  dummy.setAttribute \"value\", message\r\n  dummy.select()\r\n  document.execCommand \"copy\"\r\n  console.log \"copied\" + dummy.value\r\n  document.body.removeChild dummy\r\n\r\nget_clipboard = (evt) ->\r\n  evt.clipboardData.getData('Text')\r\n\r\ninit_data_channel = (conn) ->\r\n  data.channel = conn.createDataChannel 'data'\r\n  hook_data_channel data.channel\r\n\r\nreceive_data_channel = (e) ->\r\n  console.log 'received channel', e\r\n  data.channel = e.channel\r\n  hook_data_channel data.channel\r\n\r\ncreate_local_offer = ->\r\n  data.connection.createOffer().then (des) =>\r\n    data.connection.setLocalDescription(des)\r\n    .catch err_handler\r\n  .catch err_handler\r\n\r\nlocal_offer_onclick = ->\r\n  sdp = null\r\n  create_local_offer().then () =>\r\n    sdp = JSON.stringify data.connection.localDescription\r\n  setTimeout (() => set_clipboard sdp), 1000\r\n  change_status ['host', 'pending']\r\n\r\nremote_onpaste = (evt) ->\r\n  [type, phase] = data.status\r\n  \r\n  if type is 'host' and phase is 'pending'\r\n    answer_remote get_clipboard evt\r\n  \r\n  if type is 'guest' and phase is 'begin'\r\n    answer_remote get_clipboard evt\r\n    change_status ['guest', 'pending']\r\n\r\nlocal_answer_onclick = ->\r\n  set_clipboard JSON.stringify data.connection.localDescription\r\n\r\nanswer_remote = (remote_sdp) ->\r\n  remote_des = new RTCSessionDescription JSON.parse remote_sdp\r\n  data.connection.setRemoteDescription(remote_des).then =>\r\n    data.connection.createAnswer().then (des) =>\r\n      data.connection.setLocalDescription(des)\r\n      .catch err_handler\r\n    .catch err_handler\r\n  .catch err_handler\r\n\r\nhook_data_channel = (data_channel) ->\r\n  data_channel.onopen = (e) ->\r\n    console.log 'chat channel is open', e\r\n    [type, phase] = data.status\r\n    change_status [type, 'connected']\r\n  \r\n  data_channel.onmessage = (e) ->\r\n    console.log 'received' + e.data\r\n    inputs.chat.innerHTML = inputs.chat.innerHTML + \"<pre>\"+ e.data + \"</pre>\"\r\n\r\n  data_channel.onclose = ->\r\n    console.log 'chat channel closed'\r\n\r\nerr_handler = (err) ->\r\n  console.log err\r\n\r\nsend_message = ->\r\n  text = inputs.send_txt.value\r\n  chat.innerHTML = chat.innerHTML + \"<pre class=sent>\" + text + \"</pre>\"\r\n  data.channel.send text\r\n  inputs.send_txt.value = \"\"\r\n\r\nwindow.peer = {\r\n  init,\r\n  change_status,\r\n  local_offer_onclick,\r\n  local_answer_onclick,\r\n  send_message\r\n}\r\n"
  ]
}