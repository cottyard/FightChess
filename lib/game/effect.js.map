{
  "version": 3,
  "file": "effect.js",
  "sourceRoot": "..\\..",
  "sources": [
    "src\\game\\effect.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class Assist\r\n  constructor: (@coord_from, @coord_to) ->\r\n  render: (ctx) ->\r\n    [[x, y], [to_x, to_y]] = calc.shrink_segment calc.coord_to_pos(@coord_from), calc.coord_to_pos(@coord_to)\r\n    shape.save_style ctx\r\n    shape.set_style ctx, shape.style_blue_tp\r\n    shape.arrow ctx, x, y, to_x, to_y\r\n    shape.restore_style ctx\r\n    \r\n  next_frame: ->\r\n    no\r\n\r\nclass Attack\r\n  constructor: (@coord_from, @coord_to) ->\r\n    @transparency = 1\r\n\r\n  render: (ctx) ->\r\n    [[x, y], [to_x, to_y]] = calc.shrink_segment calc.coord_to_pos(@coord_from), calc.coord_to_pos(@coord_to)\r\n    shape.save_style ctx\r\n    shape.set_style ctx, \"rgba(255, 0, 0, #{@transparency})\"\r\n    ctx.lineWidth = 3\r\n    shape.arrow ctx, x, y, to_x, to_y, 10\r\n    shape.restore_style ctx\r\n\r\n  next_frame: ->\r\n    @transparency -= 0.2\r\n    if @transparency >= 0.2 then yes else no\r\n\r\nclass Hurt\r\n  constructor: (@coord) ->\r\n    @transparency = 0.3\r\n\r\n  render: (ctx) ->\r\n    shape.save_style ctx\r\n    shape.set_style ctx, \"rgba(255, 0, 0, #{@transparency})\"\r\n    [x, y] = calc.coord_to_pos @coord\r\n    shape.rectangle ctx, \\\r\n      x - settings.half_grid_size, y - settings.half_grid_size, \\\r\n      settings.grid_size, settings.grid_size, yes\r\n    shape.restore_style ctx\r\n    \r\n  next_frame: ->\r\n    @transparency -= 0.1\r\n    if @transparency >= 0.1 then yes else no\r\n\r\neffects_assist = []\r\neffects_attack = []\r\neffects_hurt = []\r\n\r\non_battle_assist = (evt) ->\r\n  effects_assist.push new Assist evt.coord_from, evt.coord_to\r\n\r\non_battle_attack = (evt) ->\r\n  effects_attack.push new Attack evt.coord_from, evt.coord_to\r\n\r\non_piece_hurt = (evt) ->\r\n  effects_hurt.push new Hurt evt.coord\r\n\r\nrender_effects = (ctx, effects) ->\r\n  for e, i in effects\r\n    e.render ctx\r\n    to_be_continued = e.next_frame()\r\n    effects[i] = null unless to_be_continued\r\n  effects.filter (e) -> e?\r\n\r\nrender_all = ->\r\n  ctx = ui.ctx.static\r\n  effects_assist = render_effects ctx, effects_assist\r\n  effects_attack = render_effects ctx, effects_attack\r\n  effects_hurt = render_effects ctx, effects_hurt\r\n\r\ninit = ->\r\n  ev.hook 'battle_assist', on_battle_assist\r\n  ev.hook 'battle_attack', on_battle_attack\r\n  ev.hook 'piece_hurt', on_piece_hurt\r\n  ev.hook 'render', render_all\r\n\r\nassist_byte_spec =\r\n    from_x: 1\r\n    from_y: 1\r\n    to_x: 1\r\n    to_y: 1\r\n\r\nattack_byte_spec =\r\n    from_x: 1\r\n    from_y: 1\r\n    to_x: 1\r\n    to_y: 1\r\n    tp: 1\r\n\r\nhurt_byte_spec =\r\n    x: 1\r\n    y: 1\r\n    tp: 1\r\n\r\nget_state = ->\r\n  serialized_assist = []\r\n  for e in effects_assist\r\n    e_obj =\r\n      from_x: e.coord_from[0]\r\n      from_y: e.coord_from[1]\r\n      to_x: e.coord_to[0]\r\n      to_y: e.coord_to[1]\r\n    serialized_assist.push calc.obj_to_arraybuffer e_obj, assist_byte_spec\r\n\r\n  serialized_attack = []\r\n  for e in effects_attack\r\n    e_obj =\r\n      from_x: e.coord_from[0]\r\n      from_y: e.coord_from[1]\r\n      to_x: e.coord_to[0]\r\n      to_y: e.coord_to[1]\r\n      tp: Math.floor e.transparency * 10\r\n    serialized_attack.push calc.obj_to_arraybuffer e_obj, attack_byte_spec\r\n\r\n  serialized_hurt = []\r\n  for e in effects_hurt\r\n    e_obj =\r\n      x: e.coord[0]\r\n      y: e.coord[1]\r\n      tp: Math.floor e.transparency * 10\r\n    serialized_hurt.push calc.obj_to_arraybuffer e_obj, hurt_byte_spec\r\n\r\n  {\r\n    assist: serialized_assist,\r\n    attack: serialized_attack,\r\n    hurt: serialized_hurt\r\n  }\r\n\r\nset_state = (state) ->\r\n  serialized_assist = state.assist\r\n  effects_assist = []\r\n  for se in serialized_assist\r\n    e_obj = calc.arraybuffer_to_obj se, assist_byte_spec\r\n    effects_assist.push new Assist [e_obj.from_x, e_obj.from_y], [e_obj.to_x, e_obj.to_y]\r\n\r\n  serialized_attack = state.attack\r\n  effects_attack = []\r\n  for se in serialized_attack\r\n    e_obj = calc.arraybuffer_to_obj se, attack_byte_spec\r\n    atk = new Attack [e_obj.from_x, e_obj.from_y], [e_obj.to_x, e_obj.to_y]\r\n    atk.transparency = e_obj.tp / 10\r\n    effects_attack.push atk\r\n\r\n  serialized_hurt = state.hurt\r\n  effects_hurt = []\r\n  for se in serialized_hurt\r\n    e_obj = calc.arraybuffer_to_obj se, hurt_byte_spec\r\n    hrt = new Hurt [e_obj.x, e_obj.y]\r\n    hrt.transparency = e_obj.tp / 10\r\n    effects_hurt.push hrt\r\n\r\nwindow.effect = {\r\n  init,\r\n  get_state,\r\n  set_state\r\n}"
  ]
}