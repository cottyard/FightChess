{
  "version": 3,
  "file": "piece.js",
  "sourceRoot": "..\\..\\..",
  "sources": [
    "src\\game\\core\\piece.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class Piece\r\n  constructor: (@color, @type) ->\r\n    @retrieve_basic_info()\r\n    @initialize_state_info()\r\n    \r\n  retrieve_basic_info: ->\r\n    ability = rule.ability[@type]\r\n    \r\n    @attack = ability['atk']\r\n    @attack_cd = ability['atk_cd']\r\n    @assistance = ability['ast']\r\n    @hp_total = ability['hp']\r\n    @shield_total_born = ability['shield']\r\n    @shield_heal_born = ability['shield_heal']\r\n    @move_cd = ability['move_cd']\r\n\r\n  initialize_state_info: ->\r\n    @hp = @hp_total\r\n    @shield = @shield_total = @shield_total_born\r\n    @shield_heal = @shield_heal_born\r\n    @attack_cd_ticks = 0\r\n    @move_cd_ticks = 0\r\n\r\n  info: ->\r\n    \"\"\"hp: #{Math.ceil @hp}/#{@hp_total}\r\n       shield: #{Math.floor @shield}/#{@shield_total} (#{@shield_heal.toFixed(1)})\r\n    \"\"\"\r\n\r\n  inflict: (damage) ->\r\n    if @shield >= damage\r\n      @shield -= damage\r\n      false\r\n    else\r\n      damage -= @shield\r\n      @shield = 0\r\n      @hp -= damage\r\n      true\r\n\r\n  assist: (assistance) ->\r\n    @shield_total += assistance[0]\r\n    @shield_heal += assistance[1]\r\n\r\n  activate_attack_cd: ->\r\n    @attack_cd_ticks = @attack_cd\r\n\r\n  reduce_attack_cd: ->\r\n    if @attack_cd_ticks > 0\r\n      @attack_cd_ticks--\r\n\r\n  adjust_shield: ->\r\n    if @shield > @shield_total\r\n      @shield = @shield_total\r\n\r\n  recover_shield: ->\r\n    @shield += @shield_heal\r\n    @adjust_shield()\r\n\r\n  activate_move_cd: ->\r\n    @move_cd_ticks = @move_cd\r\n\r\n  reduce_move_cd: ->\r\n    if @move_cd_ticks > 0\r\n      @move_cd_ticks--\r\n\r\n  heal: (hp) ->\r\n    @hp += hp\r\n    if @hp > @hp_total\r\n      @hp = @hp_total\r\n\r\n  can_move: ->\r\n    @move_cd_ticks is 0\r\n\r\n  is_dead: ->\r\n    @hp <= 0\r\n\r\n  clone: ->\r\n    p = new Piece @color, @type\r\n    p.hp = @hp\r\n    p.shield = @shield\r\n    p.shield_total = @shield_total\r\n    p.shield_heal = @shield_heal\r\n    p.attack_cd_ticks = @attack_cd_ticks\r\n    p.move_cd_ticks = @move_cd_ticks\r\n    p\r\n\r\n  equals: (another) ->\r\n    @type is another.type and @color is another.color\r\n\r\n  change_type: (type) ->\r\n    @type = type\r\n    @retrieve_basic_info()\r\n    @initialize_state_info()\r\n    \r\nbyte_spec = \r\n  color: 1\r\n  type: 1\r\n  hp: 2\r\n  sd: 2\r\n  sd_total: 2\r\n  sd_heal: 1\r\n  atk_cd: 1\r\n  mv_cd: 1\r\n\r\nserialization_btyes = 11\r\n\r\nserialize_piece = (piece, [coord_x, coord_y]) ->\r\n  piece_obj =\r\n    color: if piece.color is 'white' then 0 else 1\r\n    type: (a for a of rule.ability).indexOf piece.type\r\n    hp: calc.wrap_float_for_arraybuffer piece.hp\r\n    sd: calc.wrap_float_for_arraybuffer piece.shield\r\n    sd_total: calc.wrap_float_for_arraybuffer piece.shield_total\r\n    sd_heal: calc.wrap_float_for_arraybuffer piece.shield_heal\r\n    atk_cd: piece.attack_cd_ticks\r\n    mv_cd: piece.move_cd_ticks\r\n  \r\n  calc.obj_to_arraybuffer piece_obj, byte_spec\r\n\r\ndeserialize_piece = (buffer) ->\r\n  piece_obj = calc.arraybuffer_to_obj buffer, byte_spec\r\n\r\n  color = if piece_obj.color is 0 then 'white' else 'black'\r\n  type = (a for a of rule.ability)[piece_obj.type]\r\n\r\n  piece = new Piece color, type\r\n  piece.hp = calc.unwrap_float_from_arraybuffer piece_obj.hp\r\n  piece.shield = calc.unwrap_float_from_arraybuffer piece_obj.sd\r\n  piece.shield_total = calc.unwrap_float_from_arraybuffer piece_obj.sd_total\r\n  piece.shield_heal = calc.unwrap_float_from_arraybuffer piece_obj.sd_heal\r\n  piece.attack_cd_ticks = piece_obj.atk_cd\r\n  piece.move_cd_ticks = piece_obj.mv_cd\r\n  piece\r\n\r\nwindow.piece = {\r\n  Piece,\r\n  \r\n  serialize_piece,\r\n  deserialize_piece,\r\n  serialization_btyes\r\n}"
  ]
}